image: registry.gitlab.com/modioab/base-image:fedora-24-build-latest
before_script:
  - docker login -u $BUILD_USER -p $BUILD_PASSWORD -e "autobuild@modio.se" registry.gitlab.com
  - docker info

build-image:
  stage: build
  tags:
    - docker
    - x86_64
  script:
    - make -C build all


zabbix-web:
  stage: build
  tags:
    - docker
    - x86_64
  script:
    - make -C zabbix-web all


python3-image:
  stage: build
  tags:
    - docker
    - x86_64
  script:
    - ./build-python-image.sh


arm-rootfs:
    image: registry.gitlab.com/modioab/base-image:debian-armv7-bootstrap
    stage: build
    tags: 
        - arm
    script:
        - apt-get update
        - apt-get install -y -qq debootstrap
        - make -C debian-armv7 rootfs
    artifacts:
        paths:
            - debian-armv7/rootfs.tar.gz

arm-container:
    stage: test # Because we want it in the stage after build
    tags: 
        - docker
        - x86_64
    dependencies:
        - arm-rootfs
    script:
        - make -C debian-armv7 build publish
