%YAML 1.1
---
# Keep the includes first to illustrate that definitions that everything that
# follows override included definitions.
include:
  - local: /templates/defaults/container-build.yaml

default:
  image: registry.gitlab.com/modioab/base-image/fedora-33/container:master

stages:
  - first
  - second
  - build
  - publish
  - deploy

variables:
  # This is specified up front to make it explicit and visible for inventory
  # Do not set this in makefiles or other places, except as job variables below.
  FEDORA_ROOT_RELEASE: 33

workflow:
  rules:
    - if: '$CI_PIPELINE_SOURCE == "push"'
    - if: '$CI_PIPELINE_SOURCE == "schedule"'

# The default settings above can be overriden in any of the jobs that follow

container:
  stage: second
  script:
    - make -C container build test publish


build-image:
  stage: build
  script:
    - make -C build-fedora build-publish


python3:
  stage: second
  script:
    - make -C python3-image build-publish

jstest:
  stage: second
  script:
    - make -C jstest build-publish


debian9-cross:
  stage: build
  script:
    - make -C debian9-cross build-publish


debian9-firmware:
  stage: build
  script:
    - make -C debian9-firmware build-publish


debian10-firmware:
  stage: build
  script:
    - make -C debian10-firmware build-publish


nodejs:
  stage: second
  script:
    - make -C nodejs-image build-publish


nginx:
  stage: second
  script:
    - make -C nginx build-publish


meteor-1.10:
  stage: second
  variables:
    METEOR_RELEASE: '1.10.1'
  script:
    - make -C meteor-image build-publish

meteor-1.8.2:
  stage: second
  variables:
    METEOR_RELEASE: '1.8.2'
  script:
    - make -C meteor-image build-publish


c-image:
  stage: second
  script:
    - make -C c-image build-publish


go-image:
  stage: second
  script:
    - make -C go-image build-publish

rust:
  stage: second
  script:
    - make -C rust build-publish

rust-cross:
  stage: second
  script:
    - make -C rust-cross build-publish
...
